steps:
- name: 'gcr.io/cloud-builders/docker'
  args:
    - 'build'
    - '--file=Dockerfile-4'
    - '--tag=gcr.io/$PROJECT_ID/swift:4'
    - '.'
  id: '4'

# Test versions
- name: 'gcr.io/cloud-builders/docker'
  args:
    - 'run'
    - '--rm'
    - 'gcr.io/$PROJECT_ID/swift:4'
    - 'swift'
    - '--version'
  wait_for: ['4']

# Tag versions
- name: 'gcr.io/cloud-builders/docker'
  args:
    - 'tag'
    - 'gcr.io/$PROJECT_ID/swift:4'
    - 'gcr.io/$PROJECT_ID/swift'
  wait_for: ['4']
  id: 'latest'

- name: 'gcr.io/cloud-builders/docker'
  args:
    - 'tag'
    - 'gcr.io/$PROJECT_ID/swift:4'
    - 'gcr.io/$PROJECT_ID/swift:4.2'
  wait_for: ['4']
  id: '4.2'

- name: 'gcr.io/cloud-builders/docker'
  args:
    - 'tag'
    - 'gcr.io/$PROJECT_ID/swift:4'
    - 'gcr.io/$PROJECT_ID/swift:4.2.1'
  wait_for: ['4']
  id: '4.2.1'

# Test latest
- name: 'gcr.io/cloud-builders/docker'
  args:
    - 'run'
    - '--rm'
    - 'gcr.io/$PROJECT_ID/swift'
    - 'swift'
    - '--version'
  wait_for: ['latest']

images:
- 'gcr.io/$PROJECT_ID/swift:latest'
- 'gcr.io/$PROJECT_ID/swift:4'
- 'gcr.io/$PROJECT_ID/swift:4.2'
- 'gcr.io/$PROJECT_ID/swift:4.2.1'
